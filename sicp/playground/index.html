<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>Document</title>
    </head>
    <body>
    </body>
    <script>
     const range = function(a, b, next) {
         return [...Array(b - a + 1).keys()].map( x => next(x));
     };

     const sum = function(term, a, next, b) {
         return range(a, b, next).reduce((acc, x) => {
             return acc + term(x);
         });
     };

     const identity = x => x;
     const square = x => x * x;
     const inc = x => x + 1;

     const sumInt = function(a, b) {
         return sum(identity, a, inc, b);
     };

     const sumSq = function(a, b) {
         return sum(square, a, inc, b);
     };

     const average = (...args) => args.reduce((acc, x) => acc+x) / args.length;

     // fixed point abstraction
     const closeEnuf = function(u, v, tolerance = 0.00001) {
         return (Math.abs(u - v) < tolerance);
     };

     const fixedPoint = function(fn, start) {
         function iter(old, cur) {
             if(closeEnuf(old, cur)) {
                 return cur;
             }
             return iter(cur, fn(cur));
         }
        return iter(start, fn(start));
     };

     const averageDamp = function(fn) {
         return function(x) {
             return average(fn(x), x);
         };
     };
     /* const averageDamp = fn => x => average(fn(x), x); */

     const sqrt = function(x) {
         return fixedPoint( y => average((x/y), y), 1);
     };

     // sqrt with average-damp as high-order procedure
     /* const sqrt = function(x) { */
     /* return fixedPoint(averageDamp( y => x / y), 1); */
     /* }; */

     const cons = (a, b) => pick => pick === 1 ? a : b;
     const car = x => x(1);
     const cdr = x => x(2);

     let p = cons(1,4);
     console.log(car(p));
     console.log(cdr(p));

     console.log(sumInt(1,10));
     console.log(sumSq(1,4));
     console.log(average(5,5,5,5));
     console.log(average(1,2,3,4,5,6,7,8,9,10));
     console.log(sqrt(9));
    </script>
</html>
